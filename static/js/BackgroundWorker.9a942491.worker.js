!function(e){var r={};function t(n){if(r[n])return r[n].exports;var a=r[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var a in e)t.d(n,a,function(r){return e[r]}.bind(null,a));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="/genshin-optimizer-beta/",t(t.s=2)}([function(e,r,t){e.exports=t(1)},function(e,r,t){var n=function(e){"use strict";var r,t=Object.prototype,n=t.hasOwnProperty,a="function"===typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",i=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function c(e,r,t){return Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}),e[r]}try{c({},"")}catch(P){c=function(e,r,t){return e[r]=t}}function s(e,r,t,n){var a=r&&r.prototype instanceof m?r:m,o=Object.create(a.prototype),i=new L(n||[]);return o._invoke=function(e,r,t){var n=l;return function(a,o){if(n===d)throw new Error("Generator is already running");if(n===h){if("throw"===a)throw o;return A()}for(t.method=a,t.arg=o;;){var i=t.delegate;if(i){var u=j(i,t);if(u){if(u===v)continue;return u}}if("next"===t.method)t.sent=t._sent=t.arg;else if("throw"===t.method){if(n===l)throw n=h,t.arg;t.dispatchException(t.arg)}else"return"===t.method&&t.abrupt("return",t.arg);n=d;var c=f(e,r,t);if("normal"===c.type){if(n=t.done?h:p,c.arg===v)continue;return{value:c.arg,done:t.done}}"throw"===c.type&&(n=h,t.method="throw",t.arg=c.arg)}}}(e,t,i),o}function f(e,r,t){try{return{type:"normal",arg:e.call(r,t)}}catch(P){return{type:"throw",arg:P}}}e.wrap=s;var l="suspendedStart",p="suspendedYield",d="executing",h="completed",v={};function m(){}function y(){}function g(){}var b={};c(b,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(_([])));x&&x!==t&&n.call(x,o)&&(b=x);var E=g.prototype=m.prototype=Object.create(b);function k(e){["next","throw","return"].forEach((function(r){c(e,r,(function(e){return this._invoke(r,e)}))}))}function O(e,r){function t(a,o,i,u){var c=f(e[a],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"===typeof l&&n.call(l,"__await")?r.resolve(l.__await).then((function(e){t("next",e,i,u)}),(function(e){t("throw",e,i,u)})):r.resolve(l).then((function(e){s.value=e,i(s)}),(function(e){return t("throw",e,i,u)}))}u(c.arg)}var a;this._invoke=function(e,n){function o(){return new r((function(r,a){t(e,n,r,a)}))}return a=a?a.then(o,o):o()}}function j(e,t){var n=e.iterator[t.method];if(n===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=r,j(e,t),"throw"===t.method))return v;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var a=f(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,v;var o=a.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=r),t.delegate=null,v):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,v)}function M(e){var r={tryLoc:e[0]};1 in e&&(r.catchLoc=e[1]),2 in e&&(r.finallyLoc=e[2],r.afterLoc=e[3]),this.tryEntries.push(r)}function S(e){var r=e.completion||{};r.type="normal",delete r.arg,e.completion=r}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(M,this),this.reset(!0)}function _(e){if(e){var t=e[o];if(t)return t.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var a=-1,i=function t(){for(;++a<e.length;)if(n.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=r,t.done=!0,t};return i.next=i}}return{next:A}}function A(){return{value:r,done:!0}}return y.prototype=g,c(E,"constructor",g),c(g,"constructor",y),y.displayName=c(g,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var r="function"===typeof e&&e.constructor;return!!r&&(r===y||"GeneratorFunction"===(r.displayName||r.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,c(e,u,"GeneratorFunction")),e.prototype=Object.create(E),e},e.awrap=function(e){return{__await:e}},k(O.prototype),c(O.prototype,i,(function(){return this})),e.AsyncIterator=O,e.async=function(r,t,n,a,o){void 0===o&&(o=Promise);var i=new O(s(r,t,n,a),o);return e.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},k(E),c(E,u,"Generator"),c(E,o,(function(){return this})),c(E,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var r=[];for(var t in e)r.push(t);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=_,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=r)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function a(n,a){return u.type="throw",u.arg=e,t.next=n,a&&(t.method="next",t.arg=r),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],u=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(c&&s){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,r){for(var t=this.tryEntries.length-1;t>=0;--t){var a=this.tryEntries[t];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=r&&r<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=r,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(i)},complete:function(e,r){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&r&&(this.next=r),v},finish:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var t=this.tryEntries[r];if(t.finallyLoc===e)return this.complete(t.completion,t.afterLoc),S(t),v}},catch:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var t=this.tryEntries[r];if(t.tryLoc===e){var n=t.completion;if("throw"===n.type){var a=n.arg;S(t)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:_(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=r),v}},e}(e.exports);try{regeneratorRuntime=n}catch(a){"object"===typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},function(e,r,t){"use strict";function n(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function a(e,r){if(e){if("string"===typeof e)return n(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?n(e,r):void 0}}function o(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var t=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var n,a,o=[],i=!0,u=!1;try{for(t=t.call(e);!(i=(n=t.next()).done)&&(o.push(n.value),!r||o.length!==r);i=!0);}catch(c){u=!0,a=c}finally{try{i||null==t.return||t.return()}finally{if(u)throw a}}return o}}(e,r)||a(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||a(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function c(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function s(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?c(Object(t),!0).forEach((function(r){u(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function f(e,r){var t="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=a(e))||r&&e&&"number"===typeof e.length){t&&(e=t);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,c=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return u=e.done,e},e:function(e){c=!0,i=e},f:function(){try{u||null==t.return||t.return()}finally{if(c)throw i}}}}t.r(r);t(0);function l(e,r){if(e&&r)return!Array.isArray(r)&&console.error(r),r.reduce((function(e,r){return null===e||void 0===e?void 0:e[r]}),e)}function p(e,r){return Object.fromEntries(e.map((function(e,t){return[e,r(e,t)]})))}function d(e){throw new Error("Should not reach this with value ".concat(e))}h(NaN,{key:"TODO"}),v(1),v(0);function h(e,r){return{operation:"const",operands:[],value:e,info:r}}function v(e,r){return e>=Number.MAX_VALUE/100&&(e=1/0),e<=-Number.MAX_VALUE/100&&(e=-1/0),h(e,s({key:"_"},r))}function m(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return{operation:"min",operands:g(r)}}function y(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return{operation:"max",operands:g(r)}}function g(e){return e.map((function(e){return"object"===typeof e?e:h(e)}))}function b(e,r,t){var n=new Set,a=new Set;e.forEach((function e(o){a.has(o)||(n.has(o)?console.error("Found cyclical dependency during formula traversal"):(n.add(o),r(o),o.operands.forEach(e),t(o),n.delete(o),a.add(o)))}))}function w(e,r,t){var n=new Set,a=new Map,o=new Map;function i(e){var u=a.get(e);if(u)return u;u=r(e);var c=o.get(u);return c||(n.has(u)?(console.error("Found cyclical dependency during formula mapping"),h(NaN)):(n.add(u),c=t(function(e){var r=e.operands.map(i);return x(r,e.operands)?e:s(s({},e),{},{operands:r})}(u),e),n.delete(u),a.set(e,c),o.set(u,c),c))}return e.map(i)}function x(e,r){return void 0===e?void 0===r:void 0!==r&&(e.length===r.length&&e.every((function(e,t){return e===r[t]})))}var E={min:function(e){return Math.min.apply(Math,i(e))},max:function(e){return Math.max.apply(Math,i(e))},add:function(e){return e.reduce((function(e,r){return e+r}),0)},mul:function(e){return e.reduce((function(e,r){return e*r}),1)}},k=s(s({},E),{},{res:function(e){var r=o(e,1)[0];return r<0?1-r/2:r>=.75?1/(4*r+1):1-r},sum_frac:function(e){return e[0]/e.reduce((function(e,r){return e+r}))},threshold:function(e){var r=o(e,4),t=r[0],n=r[1],a=r[2],i=r[3];return t>=n?a:i}}),O=new Set(Object.keys(E));function j(e){return w(e,(function(e){return e}),(function(e){var r=e;if(O.has(e.operation)){var t=e,n=t.operation,a=!1,o=t.operands.flatMap((function(e){return e.operation===n?(a=!0,e.operands):[e]}));r=a?s(s({},t),{},{operands:o}):t}return r}))}function M(e){function r(e){var r,t=new Map,n=f(e);try{for(n.s();!(r=n.n()).done;){var a,o=r.value;t.set(o,(null!==(a=t.get(o))&&void 0!==a?a:0)+1)}}catch(i){n.e(i)}finally{n.f()}return t}for(var t={common:{counts:new Map,formulas:new Set,operation:"add"}},n=function(){for(var n,a=void 0,u={operation:t.common.operation,operands:(n=t.common.counts,i(n).flatMap((function(e){var r=o(e,2),t=r[0],n=r[1];return Array(n).fill(t)})))},c=new Map,l=0,p=Object.keys(E);l<p.length;l++){var d=p[l];c.set(d,[])}if(e=w(e,(function(e){if(t.common.formulas.has(e)){var r=e,n=new Map(t.common.counts),a=r.operands.filter((function(e){var r=n.get(e);return!r||(n.set(e,r-1),!1)}));return a.length?(a.push(u),s(s({},r),{},{operands:a})):u}return e}),(function(e){if(!O.has(e.operation))return e;var t=e;if(a){if(a.operation===t.operation){var n,i=r(t.operands),u=new Map,s=a.counts,l=0,p=f(i.entries());try{for(p.s();!(n=p.n()).done;){var d,h=o(n.value,2),v=h[0],m=h[1],y=Math.min(m,null!==(d=s.get(v))&&void 0!==d?d:0);y?(u.set(v,y),l+=y):u.delete(v)}}catch(I){p.e(I)}finally{p.f()}l>1&&(a.counts=u,a.formulas.add(t))}}else{var g,b=c.get(t.operation),w=r(t.operands),x=f(b);try{for(x.s();!(g=x.n()).done;){var E,k=o(g.value,2),j=k[0],M=k[1],S=0,L=new Map,_=f(M.entries());try{for(_.s();!(E=_.n()).done;){var A,P=o(E.value,2),N=P[0],T=P[1],F=Math.min(T,null!==(A=w.get(N))&&void 0!==A?A:0);F&&(L.set(N,F),S+=F)}}catch(I){_.e(I)}finally{_.f()}if(S>1){a={counts:L,formulas:new Set([t,j]),operation:t.operation},c.clear();break}}}catch(I){x.e(I)}finally{x.f()}a||b.push([t,w])}return t})),!a)return"break";t.common=a};;){if("break"===n())break}return e}function S(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return!1},n={data:[],processed:new Map},a=new Map([[n,new Map]]);function u(e,r){var c,f=r.processed.get(e);if(f)return f;var p,v=e.operation;switch(v){case"const":return e;case"add":case"mul":case"max":case"min":var m=k[v],y=[],g=e.operands.filter((function(e){var t=u(e,r);return"const"!==t.operation||(y.push(t.value),!1)})).map((function(e){return u(e,r)})),b=m(y);if(isFinite(b)){if("mul"===v&&0===b){p=h(b);break}}else if("mul"!==v&&("max"!==v||b>0)&&("min"!==v||b<0)){p=h(b);break}b!==m([])&&g.push(h(b)),p=g.length<=1?null!==(c=g[0])&&void 0!==c?c:h(m([])):{operation:v,operands:g};break;case"res":case"sum_frac":var w=e.operands.map((function(e){return u(e,r)})),x=k[v];p=w.every((function(e){return"const"===e.operation}))?h(x(w.map((function(e){return e.value})))):s(s({},e),{},{operands:w});break;case"lookup":var E=u(e.operands[0],r);if("const"===E.operation){var O,j=null!==(O=e.table[E.value])&&void 0!==O?O:e.operands[1];if(j){p=u(j,r);break}}throw new Error("Unsupported ".concat(v," node while folding"));case"prio":var M=e.operands.find((function(e){var t=u(e,r);if("const"!==t.operation)throw new Error("Unsupported ".concat(v," node while folding"));return void 0!==t.value}));if(!M)throw new Error("Unsupported ".concat(v," node while folding"));p=u(M,r);break;case"match":var S=o(e.operands.map((function(e){return u(e,r)})),4),L=S[0],_=S[1],A=S[2],P=S[3];if("const"!==L.operation||"const"!==_.operation)throw new Error("Unsupported ".concat(v," node while folding"));p=L.value===_.value?A:P;break;case"threshold":var N=o(e.operands.map((function(e){return u(e,r)})),4),T=N[0],F=N[1],I=N[2],U=N[3];p="const"===T.operation&&"const"===F.operation?T.value>=F.value?I:U:s(s({},e),{},{operands:[T,F,I,U]});break;case"subscript":var G=o(e.operands.map((function(e){return u(e,r)})),1)[0];p="const"===G.operation?h(e.list[G.value]):s(s({},e),{},{operands:[G]});break;case"read":var D=r.data.map((function(r){return l(r,e.path)})).filter((function(e){return e}));if(0===D.length)if(t(e)){var z=e.accu;p=void 0===z?"string"===e.type?h(void 0):h(NaN):h(k[z]([]))}else p=e;else p=void 0===e.accu?u(D[0],r):u({operation:e.accu,operands:D},r);break;case"data":e.reset&&(r=n);var B=a.get(r),q=B.get(e.data);q||(q={data:[].concat(i(r.data),[e.data]),processed:new Map},a.set(q,new Map),B.set(e.data,q)),p=u(e.operands[0],q);break;default:d(v)}return r.processed.set(e,p),p}var c={data:[r],processed:new Map};return a.set(c,new Map),a.get(n).set(r,c),e.map((function(e){return u(e,c)}))}var L,_,A,P,N,T=["flower","plume","sands","goblet","circlet"];["physical"].concat(["anemo","geo","electro","hydro","pyro","cryo"]);function F(e,r,t,n){for(var a={nodes:e,arts:r},u={anyProgress:n},c=Object.fromEntries(Object.entries(a.arts.base).map((function(e){var r=o(e,2),t=r[0],n=r[1];return[t,{min:n,max:n}]}))),s=function(){var e=p(T,(function(e){return U(a.arts.values[e])})),r=p(T,(function(r){return I(Object.entries(e).map((function(e){return e[0]===r?c:e[1]})).filter((function(e){return e})))})),n=!1,o=p(T,(function(e){var o=a.arts.values[e].filter((function(n){var o=I([U([n]),r[e]]),i=G(a.nodes,o);return a.nodes.every((function(e,r){var n;return i.get(e).min>=(null!==(n=t[r])&&void 0!==n?n:-1/0)}))}));return o.length!==a.arts.values[e].length&&(u.anyProgress=!0,n=!0),o}));if(!n)return"break";a.arts={base:a.arts.base,values:o}};;){if("break"===s())break}if(!u.anyProgress)return{nodes:e,arts:r};var f=I([c].concat(i(Object.values(r.values).map((function(e){return U(e)}))))),l=G(a.nodes,f);return a.nodes=w(a.nodes,(function(e){var r=e.operation,t=e.operands.map((function(e){return l.get(e)}));switch(r){case"threshold":var n=o(t,4),a=n[0],u=n[1],c=n[2],s=n[3];if(a.min>=u.max)return e.operands[2];if(a.max<u.min)return h(0);if(c.max===c.min&&s.max===s.min&&c.min===s.min&&isFinite(c.min))return h(c.max);break;case"min":var f=e.operands.filter((function(e,r){var n=t[r];return t.every((function(e,r){return n.min<=e.max}))}));if(f.length<t.length)return m.apply(void 0,i(f));break;case"max":var p=e.operands.filter((function(e,r){var n=t[r];return t.every((function(e){return n.max>=e.min}))}));if(p.length<t.length)return y.apply(void 0,i(p))}return e}),(function(e){return e})),a}function I(e){var r={};return e.forEach((function(e){Object.entries(e).forEach((function(e){var t=o(e,2),n=t[0],a=t[1];r[n]?(r[n].min+=a.min,r[n].max+=a.max):r[n]=s({},a)}))})),r}function U(e){var r={};return e.forEach((function(e){var t=e.values;Object.entries(t).forEach((function(e){var t=o(e,2),n=t[0],a=t[1];r[n]?(r[n].max<a&&(r[n].max=a),r[n].min>a&&(r[n].min=a)):r[n]={min:a,max:a}}))})),r}function G(e,r){var t=new Map;return b(e,(function(e){}),(function(e){var n,a=e,i=a.operation,u=a.operands.map((function(e){return t.get(e)}));switch(i){case"read":if("dyn"!==a.path[0])throw new Error("Found non-dyn path ".concat(a.path," while computing range"));n=r[a.path[1]];break;case"const":n=D([a.value]);break;case"subscript":n=D(a.list);break;case"add":case"min":case"max":n={min:k[i](u.map((function(e){return e.min}))),max:k[i](u.map((function(e){return e.max})))};break;case"res":n={min:k[i]([u[0].max]),max:k[i]([u[0].min])};break;case"mul":n=u.reduce((function(e,r){return D([e.min*r.min,e.min*r.max,e.max*r.min,e.max*r.max])}));break;case"threshold":n=u[0].min>=u[1].max?u[2]:u[0].max<u[1].min?D([0]):D([0],[u[2]]);break;case"sum_frac":var c=o(u,2),s=c[0],f=c[1],l={min:s.min+f.min,max:s.max+f.max};n=l.min<=0&&l.max>=0?s.min<=0&&s.max>=0?{min:NaN,max:NaN}:{min:-1/0,max:1/0}:D([s.min/l.min,s.min/l.max,s.max/l.min,s.max/l.max]);break;case"data":case"lookup":case"match":throw new Error("Unsupported ".concat(i," node"));default:d(i)}t.set(a,n)})),t}function D(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=Math.max.apply(Math,i(e).concat(i(r.map((function(e){return e.max}))))),n=Math.min.apply(Math,i(e).concat(i(r.map((function(e){return e.min})))));return{min:n,max:t}}function z(e){return T.reduce((function(r,t){return r*e.values[t].length}),1)}var B=void 0;function q(e){var r=e.threshold,t=e.filter;N>r&&(N=r);var n=function(e,r){return{base:e.base,values:p(T,(function(t){var n=r[t];switch(n.kind){case"id":return e.values[t].filter((function(e){return n.ids.has(e.id)}));case"exclude":return e.values[t].filter((function(e){return!n.sets.has(e.set)}));case"required":return e.values[t].filter((function(e){return n.sets.has(e.set)}))}}))}}(B.arts,t),a=z(n),u=function(e,r){return M(e=j(e=S(e,r,arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return!1})))}(B.nodes,{},(function(e){return!1}));B.min.push(N);var c=F(u,n,B.min,!1);u=c.nodes,n=c.arts,B.min.pop(),n=function(e,r){var t=!1,n=p(T,(function(n){var a=e.values[n],i=a.filter((function(e){var t=0;return a.every((function(n){var a=Object.entries(n.values).every((function(r){var t=o(r,2),n=t[0];return t[1]>=e.values[n]})),i=Object.entries(n.values).some((function(r){var t=o(r,2),n=t[0];return t[1]>e.values[n]}));return a&&(i||n.id>e.id)&&t++,t<r}))}));return i.length!==a.length&&(t=!0),i}));return t?{base:e.base,values:n}:e}(n,B.maxBuilds);var f=function(e,r){var t=new Set,n=new Set,a=new Map;b(e,(function(e){}),(function(e){var o=e.operation;switch(o){case"read":if("number"!==e.type||e.accu&&"add"!==e.accu)throw new Error("Unsupported ".concat(o," node in precompute"));var i=r(e);t.add(i),a.set(e,i);break;case"add":case"min":case"max":case"mul":case"threshold":case"res":case"sum_frac":a.set(e,{ins:e.operands.map((function(e){return a.get(e)}))});break;case"const":if("number"!==typeof e.value)throw new Error("Found string constant while precomputing");var u=e.value;n.add(u),a.set(e,u);break;case"match":case"lookup":case"subscript":case"prio":case"data":throw new Error("Unsupported ".concat(o," node in precompute"));default:d(o)}}));var u=new Map,c=i(t),s=e.length,f=i(n),l=[];e.forEach((function(e,r){u.set(e,r),"const"===e.operation&&u.set(e.value,r)})),c.forEach((function(r,t){return u.set(r,t+e.length)}));var p=e.length+c.length;f.forEach((function(e){return u.has(e)||u.set(e,p++)})),a.forEach((function(e,r){"object"===typeof e?(u.has(r)||u.set(r,p++),l.push({out:u.get(r),ins:r.operands.map((function(e){return u.get(e)})),op:k[r.operation],buff:Array(r.operands.length).fill(0)})):u.set(r,u.get(e))}));var h=Array(p).fill(0);h.forEach((function(e,r,t){return t[r]=NaN})),n.forEach((function(e){return h[u.get(e)]=e}));var v=e.map((function(e,r){var t=u.get(e);return t!==r?[t,r]:void 0})).filter((function(e){return e})),m=v.length?function(){v.forEach((function(e){var r=o(e,2),t=r[0],n=r[1];return h[n]=h[t]}))}:void 0;return function(e){return c.forEach((function(r,t){var n;return h[s+t]=null!==(n=e[r])&&void 0!==n?n:0})),l.forEach((function(e){var r=e.out,t=e.ins,n=e.op,a=e.buff;t.forEach((function(e,r){return a[r]=h[e]})),h[r]=n(a)})),null===m||void 0===m||m(),h}}(u,(function(e){return e.path[1]})),l=Object.values(n.values).sort((function(e,r){return e.length-r.length})),h=Array(l.length).fill(""),v={build:0,failed:0,skipped:a-z(n)};return function e(r,t){if(r<0){var n=f(t);if(B.min.every((function(e,r){return e<=n[r]}))){var a=n[B.min.length];if(a>=N&&_.push({value:a,plot:n[B.min.length+1],artifactIds:i(h)}),P){var u=n[B.min.length+1];(!P[u]||P[u].value<a)&&(P[u]={value:a,artifactIds:i(h)})}}else v.failed+=1}else l[r].forEach((function(n){h[r]=n.id;var a=s({},t);Object.entries(n.values).forEach((function(e){var r,t=o(e,2),n=t[0],i=t[1];return a[n]=(null!==(r=a[n])&&void 0!==r?r:0)+i})),e(r-1,a)})),0===r&&(v.build+=l[0].length,v.build>8192&&C(v))}(l.length-1,B.arts.base),C(v),{command:"request",id:L,total:a}}var C=function(e){R(!1),B.callback({command:"interim",id:L,buildValues:A,buildCount:e.build,failedCount:e.failed,skippedCount:e.skipped}),A=void 0,e.build=0,e.failed=0,e.skipped=0};function R(e){var r;(P&&Object.keys(P).length>=1e5&&(P=function(e){for(var r={scale:.01},t=new Set(e.flatMap((function(e){return Object.values(e).map((function(e){return Math.round(e.value/r.scale)}))})));t.size>1500;)r.scale*=2,t=new Set(i(t).map((function(e){return Math.round(e/2)})));var n,a={},o=f(e);try{for(o.s();!(n=o.n()).done;)for(var u=n.value,c=0,s=Object.values(u);c<s.length;c++){var l=s[c],p=Math.round(l.value/r.scale)*r.scale;(!a[p]||a[p].value<l.value)&&(a[p]=l)}}catch(d){o.e(d)}finally{o.f()}return a}([P])),_.length>=1e5||e)&&(_=_.sort((function(e,r){return r.value-e.value})).slice(0,B.maxBuilds),A=_.map((function(e){return e.value})),N=Math.max(N,null!==(r=A[B.maxBuilds-1])&&void 0!==r?r:-1/0))}onmessage=function(e){var r,t,n=e.data,a=n.command;switch(a){case"setup":postMessage((t=function(e){return postMessage(e,void 0)},(B=s({},r=n)).nodes=r.filters.map((function(e){return e.value})),B.min=r.filters.map((function(e){return e.min})),B.callback=t,B.nodes.push(r.optimizationTarget),r.plotBase&&(P={},B.nodes.push(r.plotBase)),L=r.id,_=[],A=void 0,N=-1/0,{command:"request",id:L}));break;case"request":postMessage(q(n));break;case"finalize":postMessage((R(!0),{command:"finalize",id:L,builds:_,plotData:P}));break;default:d(a)}}}]);
//# sourceMappingURL=BackgroundWorker.9a942491.worker.js.map